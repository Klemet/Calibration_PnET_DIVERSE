
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Obtaining the growth data from the Forest Vegetation Simulator that will serve as reference for the calibration &#8212; Calibration of PnET Succession for the DIVERSE project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'StartingCalibrationTest/5.Obtaining_Growth_data_from_FVS';</script>
    <link rel="canonical" href="https://klemet.github.io/Calibration_PnET_DIVERSE/intro.html/StartingCalibrationTest/5.Obtaining_Growth_data_from_FVS.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1st calibration step : Monoculture in ideal condition" href="6.Monoculture_ideal_conditions.html" />
    <link rel="prev" title="Setting up the calibration landscape (ecoregions, initial communities, climate etc.)" href="4.Setting_up_calibration_Landscape.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/DIVERSE_PnET_Calibration_Logo.png" class="logo__image only-light" alt="Calibration of PnET Succession for the DIVERSE project - Home"/>
    <script>document.write(`<img src="../_static/DIVERSE_PnET_Calibration_Logo.png" class="logo__image only-dark" alt="Calibration of PnET Succession for the DIVERSE project - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    👋 Welcome !
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="Intro_CalibrationTest.html">Calibration test</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1.Loading_functions.html">Loading functions and packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.Test_sim_functions.html">Making a test simulation to get used to the functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="3.Initial_Species_Parameters.html">Initial species parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.Setting_up_calibration_Landscape.html">Setting up the calibration landscape (ecoregions, initial communities, climate etc.)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Obtaining the growth data from the Forest Vegetation Simulator that will serve as reference for the calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="6.Monoculture_ideal_conditions.html">1st calibration step : Monoculture in ideal condition</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Klemet/Calibration_PnET_DIVERSE" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Klemet/Calibration_PnET_DIVERSE/issues/new?title=Issue%20on%20page%20%2FStartingCalibrationTest/5.Obtaining_Growth_data_from_FVS.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/StartingCalibrationTest/5.Obtaining_Growth_data_from_FVS.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Obtaining the growth data from the Forest Vegetation Simulator that will serve as reference for the calibration</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-python-function-used-to-obtain-growth-data-from-fvs-for-a-monoculture">Custom python function used to obtain growth data from FVS for a monoculture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-comparing-fvs-outputs-to-pnet-outputs">Test : Comparing FVS outputs to PnET outputs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#another-test-with-more-robut-parameters">Another test - with more robut parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo">TODO</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="obtaining-the-growth-data-from-the-forest-vegetation-simulator-that-will-serve-as-reference-for-the-calibration">
<h1>Obtaining the growth data from the Forest Vegetation Simulator that will serve as reference for the calibration<a class="headerlink" href="#obtaining-the-growth-data-from-the-forest-vegetation-simulator-that-will-serve-as-reference-for-the-calibration" title="Link to this heading">#</a></h1>
<p>The <a class="reference external" href="https://www.fs.usda.gov/fvs/">Forest Vegetation Simulator</a> (FVS) model was develloped by the US department of Agriculture and Forestry (USDA). It aims to predict the growth and yield of forest stands based on internal equations derived for empirical data, but it also have options to be calibrated or adjusted based on the input data.</p>
<p>Eric Gustafson recommands its use for the first step of the calibration procedure of PnET Succession (see <a class="reference download internal" download="" href="../_downloads/0c3667e495cffb2731d2820363988a43/Gustafson2024PnETUserGuide.pdf"><span class="xref download myst">Gustafson and Miranda (2023)</span></a>), where we try to make sure that the growth curve of a new cohort matches what is seen in reality. This is because the curves produced by FVS can be easily compared to PnET, without the trouble that often comes when using real empirical data for such a procedure (as empirical data is messy, needs to be cleaned, has outliers, etc.). As such, using FVS to calibrate PnET is called by some “meta-modelling” - as empirical data has been used to create the FVS model, which is then used to calibrate PnET.</p>
<p>The FVS model is already compiled inside of the Docker image used to produced this document (see the <a class="reference external" href="https://github.com/Klemet/Calibration_PnET_DIVERSE/blob/main/README.md">readme file</a> to deploy it easily on your computer), thanks to the code provided in <a class="reference external" href="https://github.com/USDAForestService/ForestVegetationSimulator/issues/44#issuecomment-2483578729">this issue</a>. What that means is that FVS can be run from Python functions that I created here (see <a class="reference download internal" download="" href="../_downloads/53d7d171bcfe75ee936a67526a50ff02/functionsForCalibration.py"><span class="xref download myst">functionsForCalibration.py</span></a>) without any need for manually creating the intputs for a FVS simulation (or projection, as it is more usually called in the user guides); or to manually analyze the outputs of FVS.</p>
<section id="custom-python-function-used-to-obtain-growth-data-from-fvs-for-a-monoculture">
<h2>Custom python function used to obtain growth data from FVS for a monoculture<a class="headerlink" href="#custom-python-function-used-to-obtain-growth-data-from-fvs-for-a-monoculture" title="Link to this heading">#</a></h2>
<p>The function <code class="docutils literal notranslate"><span class="pre">FVS_on_simulationOnSingleEmptyStand</span></code> (inside <a class="reference download internal" download="" href="../_downloads/53d7d171bcfe75ee936a67526a50ff02/functionsForCalibration.py"><span class="xref download myst">functionsForCalibration.py</span></a>) will be main one that we will be using to calibrate PnET.</p>
<p>This function does the following :</p>
<ul class="simple">
<li><p>It creates a MySQL database containg the stand and trees inputs necessary for a simple FVS simulation that contains only young trees of a single species (monoculture) in ideal or default conditions at the beginning.</p>
<ul>
<li><p>These initial conditions are used to replicate what happens when we initialize a new age cohort on an empty cell in PnET, in order to do the calibration on monoculture and ideal conditions.</p></li>
<li><p>While the function allows the user to specify the number of trees, I will use 2471 trees (which will initialize a 1ha stand with 2471 trees) which is the value used in <a class="reference external" href="https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085">Reese et al. 2024, supp. mat. A</a> (recommanded by <a class="reference external" href="https://research.fs.usda.gov/about/people/sturtevant">Brian Sturtevant</a>).</p></li>
<li><p>The function also allows the user to specify the “Site index” for the stand, which is a value representing the quality of the soil for the species (and is thus used to increase tree growth in the equations inside FVS). <a class="reference external" href="https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085">Reese et al. 2024, supp. mat. A</a> tend to use high site index as the reference to calibrate PnET, which matches the advice of <a class="reference download internal" download="" href="../_downloads/0c3667e495cffb2731d2820363988a43/Gustafson2024PnETUserGuide.pdf"><span class="xref download myst">Gustafson and Miranda (2023)</span></a> (who recommands that this first calibration step should be done on “ideal conditions”). As the Site Index is a value that varies from species to species, I recommand <a class="reference external" href="https://www.fs.usda.gov/nrs/pubs/gtr/gtr_nc128.pdf">this report from the USDA</a> that shows ranges of values of Site Index in the USA for many species. I will also make several FVS simulations with lower site index values for comparison.</p></li>
</ul>
</li>
<li><p>I creates a simple keyword file, which is the file that defines what stands are simulated, and how.</p>
<ul>
<li><p>The keyword file generated simply simulate one stand with a single tree age cohort, and output carbon estimates in the main output file (which are then used to derive aboveground biomass estimates we can compare to PnET)</p></li>
</ul>
</li>
<li><p>It runs the simulation by calling the right FVS “variant” as indicated by the user</p>
<ul>
<li><p>There exists more than a dozen FVS variants for different regions of the united states, but also one for Ontario and one for British Columbia. I’ll be using the Ontario variante here by default.</p></li>
</ul>
</li>
<li><p>It reads the outputs to return a dictionnary of values that associates a year (e.g. 2033) to an aboveground biomass value. Convertion from carbon to biomass is explained in the code of the function.</p></li>
<li><p>The files generated for (inputs) and by (outputs) the FVS simulation are deleted by default (<code class="docutils literal notranslate"><span class="pre">clearFiles</span></code> argument), but this can be overriden.</p></li>
</ul>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We import the functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functionsForCalibration</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># We run FVS three times to simulate a basalm fir monoculture on an initially empty stand, and specify all of the arguments</span>

<span class="n">basalmFir_LowSiteIndex</span> <span class="o">=</span> <span class="n">FVS_on_simulationOnSingleEmptyStand</span><span class="p">(</span><span class="n">Latitude</span> <span class="o">=</span> <span class="mf">47.22029</span><span class="p">,</span> <span class="c1"># Atikamekw village of Manawan, center of one of our study areas</span>
                                    <span class="n">Longitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">74.38606</span><span class="p">,</span> <span class="c1"># Atikamekw village of Manawan, center of one of our study areas</span>
                                    <span class="n">Slope</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no slope</span>
                                    <span class="n">Elevation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no elevation </span>
                                    <span class="n">treeSpeciesCode</span> <span class="o">=</span> <span class="s2">&quot;BF&quot;</span><span class="p">,</span> <span class="c1"># Balsam fir. All codes are available at https://github.com/USDAForestService/ForestVegetationSimulator/blob/5c29887e4168fd8182c1b2bad762f900b7d7e90c/canada/on/grinit.f#L43</span>
                                    <span class="n">treesPerHectares</span> <span class="o">=</span> <span class="mi">2471</span><span class="p">,</span> <span class="c1"># To replicate stocking density from  https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085, supp. mat. A</span>
                                    <span class="n">siteIndex</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="c1"># Low site index for Balsam fir. See https://www.fs.usda.gov/nrs/pubs/gtr/gtr_nc128.pdf</span>
                                    <span class="n">variant</span> <span class="o">=</span> <span class="s2">&quot;FVSon&quot;</span><span class="p">,</span>
                                    <span class="n">folderForFiles</span> <span class="o">=</span> <span class="s2">&quot;/calibrationFolder/FVS_SingleEmptyStandRun&quot;</span><span class="p">,</span>
                                    <span class="n">clearFiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">basalmFir_averageSiteIndex</span> <span class="o">=</span> <span class="n">FVS_on_simulationOnSingleEmptyStand</span><span class="p">(</span><span class="n">Latitude</span> <span class="o">=</span> <span class="mf">47.22029</span><span class="p">,</span> <span class="c1"># Atikamekw village of Manawan, center of one of our study areas</span>
                                    <span class="n">Longitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">74.38606</span><span class="p">,</span> <span class="c1"># Atikamekw village of Manawan, center of one of our study areas</span>
                                    <span class="n">Slope</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no slope</span>
                                    <span class="n">Elevation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no elevation </span>
                                    <span class="n">treeSpeciesCode</span> <span class="o">=</span> <span class="s2">&quot;BF&quot;</span><span class="p">,</span> <span class="c1"># Balsam fir. All codes are available at https://github.com/USDAForestService/ForestVegetationSimulator/blob/5c29887e4168fd8182c1b2bad762f900b7d7e90c/canada/on/grinit.f#L43</span>
                                    <span class="n">treesPerHectares</span> <span class="o">=</span> <span class="mi">2471</span><span class="p">,</span> <span class="c1"># To replicate stocking density from  https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085, supp. mat. A</span>
                                    <span class="n">siteIndex</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="c1"># Average site index for Balsam fir. See https://www.fs.usda.gov/nrs/pubs/gtr/gtr_nc128.pdf</span>
                                    <span class="n">variant</span> <span class="o">=</span> <span class="s2">&quot;FVSon&quot;</span><span class="p">,</span>
                                    <span class="n">folderForFiles</span> <span class="o">=</span> <span class="s2">&quot;/calibrationFolder/FVS_SingleEmptyStandRun&quot;</span><span class="p">,</span>
                                    <span class="n">clearFiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">basalmFir_HighSiteIndex</span> <span class="o">=</span> <span class="n">FVS_on_simulationOnSingleEmptyStand</span><span class="p">(</span><span class="n">Latitude</span> <span class="o">=</span> <span class="mf">47.22029</span><span class="p">,</span> <span class="c1"># Atikamekw village of Manawan, center of one of our study areas</span>
                                    <span class="n">Longitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">74.38606</span><span class="p">,</span> <span class="c1"># Atikamekw village of Manawan, center of one of our study areas</span>
                                    <span class="n">Slope</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no slope</span>
                                    <span class="n">Elevation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no elevation </span>
                                    <span class="n">treeSpeciesCode</span> <span class="o">=</span> <span class="s2">&quot;BF&quot;</span><span class="p">,</span> <span class="c1"># Balsam fir. All codes are available at https://github.com/USDAForestService/ForestVegetationSimulator/blob/5c29887e4168fd8182c1b2bad762f900b7d7e90c/canada/on/grinit.f#L43</span>
                                    <span class="n">treesPerHectares</span> <span class="o">=</span> <span class="mi">2471</span><span class="p">,</span> <span class="c1"># To replicate stocking density from  https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085, supp. mat. A</span>
                                    <span class="n">siteIndex</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> <span class="c1"># High site index for Balsam fir. See https://www.fs.usda.gov/nrs/pubs/gtr/gtr_nc128.pdf</span>
                                    <span class="n">variant</span> <span class="o">=</span> <span class="s2">&quot;FVSon&quot;</span><span class="p">,</span>
                                    <span class="n">folderForFiles</span> <span class="o">=</span> <span class="s2">&quot;/calibrationFolder/FVS_SingleEmptyStandRun&quot;</span><span class="p">,</span>
                                    <span class="n">clearFiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been deleted.
The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been created.
Creating Database with stand and tree ini values
Creating Keyword file
Launching FVS sim
Clearing files
The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been deleted.
The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been created.
Creating Database with stand and tree ini values
Creating Keyword file
Launching FVS sim
Clearing files
The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been deleted.
The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been created.
Creating Database with stand and tree ini values
Creating Keyword file
Launching FVS sim
Clearing files
The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been deleted.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We print the outputs of one of the simulations</span>
<span class="nb">print</span><span class="p">(</span><span class="n">basalmFir_HighSiteIndex</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{2023: 0.4, 2033: 2.6, 2043: 21.6, 2053: 61.0, 2063: 86.4, 2073: 113.6, 2083: 134.4, 2093: 155.6, 2103: 175.8, 2113: 196.6, 2123: 216.8, 2133: 239.6}
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">Other uses of FVS</p>
<p>FVS can also output belowground biomass (both live and dead) using the CARBPRET (carbon report) keyword.
This can be useful to paramterize several parameters of PnET Succession related to the biomass of roots.</p>
</div>
<div class="note admonition">
<p class="admonition-title">Learning more about FVS</p>
<p>FVS is a complex model with more than a decade of improvments. The existing Python functions present here should be enough to calibrate PnET Succession; but if you need more information about variants, possible outputs and inputs, you can take a look at the many <a class="reference external" href="https://www.fs.usda.gov/fvs/documents/guides.shtml">user guides</a> that are available online.</p>
</div>
</section>
<section id="test-comparing-fvs-outputs-to-pnet-outputs">
<h2>Test : Comparing FVS outputs to PnET outputs<a class="headerlink" href="#test-comparing-fvs-outputs-to-pnet-outputs" title="Link to this heading">#</a></h2>
<p>Using the same functions to read and run a simple PnET scenario as used in <a class="reference internal" href="2.Test_sim_functions.html"><span class="std std-doc">Making a test simulation to get used to the functions</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading parameters and launching a simple PnET sim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functionsForCalibration</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="c1"># Loading parameters from template</span>
<span class="n">PnETGitHub_OneCellSim</span> <span class="o">=</span> <span class="n">parse_All_LANDIS_PnET_Files</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;./SimulationFiles/PnETGitHub_OneCellSim_v8&quot;</span><span class="p">)</span>
<span class="c1"># Editing initial communities to only have single cohort of Pinus banksiana</span>
<span class="c1"># Updated for v8</span>
<span class="c1"># we clear all of the rows</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;initial-communities.csv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;initial-communities.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># We add a single new row for pinus banksiana with biomass 0 (there will be a spin up anyway)</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;initial-communities.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>	<span class="s2">&quot;pinubank&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]</span>
<span class="c1"># print(PnETGitHub_OneCellSim[&quot;initial-communities.txt&quot;])</span>
<span class="c1"># Editing cell length so that one cell = 1ha</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;scenario.txt&quot;</span><span class="p">][</span><span class="s2">&quot;CellLength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Putting duration to 120 years</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;scenario.txt&quot;</span><span class="p">][</span><span class="s2">&quot;Duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found : Additional file : !Run_scenario.bat
Found : PnET OutputBiomass parameter file : biomass.outputPnET.txt
Found : Climate file : climate.txt
Found : Disturbance Reduction File : disturbance_reductions.txt
Found : Additional file : ecoregion.img
Found : Main ecoregions file : ecoregion.txt
Found : PnET Ecoregion parameter file : EcoregionParameters.txt
Found : Initial Communities file : initial-communities.csv
Found : Additional file : initial-communities.img
Found : Additional file : Landis-log.txt
Found : PnET generic parameter file : PnETGenericParameters.txt
Found : PnET OutputSites parameter file : PnEToutputsites_onecell.txt
Found : Main PnET parameter file : pnetsuccession.txt
Found : Additional file : README.txt
Found : Main scenario file : scenario.txt
Found : Main species parameter file : species.txt
Found : PnET species parameters file : SpeciesParameters.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Writing parameters in temporary folder</span>
<span class="n">testScenarioPath</span> <span class="o">=</span> <span class="s2">&quot;/tmp/TestScenarioPnET/&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">)</span>

<span class="n">write_all_LANDIS_files</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">,</span>
                       <span class="n">PnETGitHub_OneCellSim</span><span class="p">,</span>
                       <span class="kc">True</span><span class="p">)</span>
<span class="c1"># Running LANDIS-II sim</span>
<span class="n">runLANDIS_Simulation</span><span class="p">(</span><span class="s2">&quot;/tmp/TestScenarioPnET/&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;scenario.txt&quot;</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="mi">5</span><span class="p">)</span>
<span class="c1"># Parsing outputs</span>
<span class="n">result_sitesCSV</span> <span class="o">=</span> <span class="n">parse_CSVFiles_PnET_SitesOutput</span><span class="p">(</span><span class="s2">&quot;/tmp/TestScenarioPnET/Output/Site1&quot;</span><span class="p">,</span>
                                                  <span class="nb">int</span><span class="p">(</span><span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;pnetsuccession.txt&quot;</span><span class="p">][</span><span class="s2">&quot;StartYear&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found : Additional file : !Run_scenario.bat
Found : PnET OutputBiomass parameter file : biomass.outputPnET.txt
Found : Climate file : climate.txt
Found : Disturbance Reduction File : disturbance_reductions.txt
Found : Additional file : ecoregion.img
Found : Main ecoregions file : ecoregion.txt
Found : PnET Ecoregion parameter file : EcoregionParameters.txt
Found : dataframe : initial-communities.csv, exporting to .csv
Found : Additional file : initial-communities.img
Found : Additional file : Landis-log.txt
Found : PnET generic parameter file : PnETGenericParameters.txt
Found : PnET OutputSites parameter file : PnEToutputsites_onecell.txt
Found : Main PnET parameter file : pnetsuccession.txt
Found : Additional file : README.txt
Found : Main scenario file : scenario.txt
Found : Main species parameter file : species.txt
Found : PnET species parameters file : SpeciesParameters.txt
Launching LANDIS-II simulation with command : /bin/bash -c &quot;cd /tmp/TestScenarioPnET/ &amp;&amp; dotnet $LANDIS_CONSOLE scenario.txt&quot;
The LANDIS-II simulation has finished properly!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running FVS simulation with pinus banksiana</span>
<span class="n">jackPine_HighSiteIndex</span> <span class="o">=</span> <span class="n">FVS_on_simulationOnSingleEmptyStand</span><span class="p">(</span><span class="n">Latitude</span> <span class="o">=</span> <span class="mf">42.73361</span><span class="p">,</span> <span class="c1"># Capital of michigan, to approximate where the parameters of this PnET sample scenario were made</span>
                                    <span class="n">Longitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">84.55556</span><span class="p">,</span> <span class="c1"># Capital of michigan, to approximate where the parameters of this PnET sample scenario were made</span>
                                    <span class="n">Slope</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no slope</span>
                                    <span class="n">Elevation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no elevation </span>
                                    <span class="n">treeSpeciesCode</span> <span class="o">=</span> <span class="s2">&quot;PJ&quot;</span><span class="p">,</span> <span class="c1"># Jack Pine, pinus banksiana. All codes are available at https://github.com/USDAForestService/ForestVegetationSimulator/blob/5c29887e4168fd8182c1b2bad762f900b7d7e90c/canada/on/grinit.f#L43</span>
                                    <span class="n">treesPerHectares</span> <span class="o">=</span> <span class="mi">2471</span><span class="p">,</span> <span class="c1"># To replicate stocking density from  https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085, supp. mat. A</span>
                                    <span class="n">siteIndex</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> <span class="c1"># High site index for the Jack Pine. See https://www.fs.usda.gov/nrs/pubs/gtr/gtr_nc128.pdf</span>
                                    <span class="n">variant</span> <span class="o">=</span> <span class="s2">&quot;FVSon&quot;</span><span class="p">,</span>
                                    <span class="n">timestep</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                                    <span class="n">numberOfTimesteps</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
                                    <span class="n">folderForFiles</span> <span class="o">=</span> <span class="s2">&quot;/calibrationFolder/FVS_SingleEmptyStandRun&quot;</span><span class="p">,</span>
                                    <span class="n">clearFiles</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">jackPine_HighSiteIndex</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been created.
Creating Database with stand and tree ini values
Creating Keyword file
Launching FVS sim
{2023: 0.4, 2026: 1.8, 2029: 6.0, 2032: 12.6, 2035: 21.8, 2038: 33.4, 2041: 47.8, 2044: 64.8, 2047: 81.4, 2050: 93.4, 2053: 106.4, 2056: 111.8, 2059: 114.4, 2062: 116.8, 2065: 119.0, 2068: 121.4, 2071: 123.4, 2074: 125.6, 2077: 127.8, 2080: 129.8, 2083: 131.6, 2086: 134.2, 2089: 135.0, 2092: 132.4, 2095: 130.2, 2098: 128.4, 2101: 126.4, 2104: 124.4, 2107: 122.4, 2110: 120.6, 2113: 119.0, 2116: 117.4, 2119: 115.6, 2122: 114.0, 2125: 112.6, 2128: 111.0, 2131: 109.6, 2134: 108.4, 2137: 107.0, 2140: 105.8}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ploting the outputs from PnET and FVS together</span>
<span class="c1"># We re-format the time entries of the FVS dictionnary so that years are expressed in absoluted (from 0 to 120)</span>
<span class="n">initialKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">jackPine_HighSiteIndex</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># print(initialKeys)</span>
<span class="k">if</span> <span class="n">initialKeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">initialKeys</span><span class="p">:</span>
        <span class="n">jackPine_HighSiteIndex</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">2023</span><span class="p">]</span> <span class="o">=</span> <span class="n">jackPine_HighSiteIndex</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">jackPine_HighSiteIndex</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<span class="n">plot_TimeSeries_CSV_PnETSitesOutputs</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">result_sitesCSV</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">referenceDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wood(gDW)&quot;</span><span class="p">:{</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">jackPine_HighSiteIndex</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">jackPine_HighSiteIndex</span><span class="o">.</span><span class="n">values</span><span class="p">())}},</span>
                                     <span class="n">columnToPlotSelector</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Wood(gDW)&quot;</span><span class="p">],</span>
                                     <span class="n">trueTime</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                     <span class="n">realBiomass</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">cellLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;scenario.txt&quot;</span><span class="p">][</span><span class="s2">&quot;CellLength&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>All plots have been generated and saved.
</pre></div>
</div>
<img alt="../_images/0574f2ff9e238c93d92d71f61fe3ded73fa6279948b01552772782884b0db4ce.png" src="../_images/0574f2ff9e238c93d92d71f61fe3ded73fa6279948b01552772782884b0db4ce.png" />
</div>
</div>
<p>Here, we can see a pretty large divergence between the prediction of PnET succession and the projection of FVS. The parameters used in PnET Succession are derived from a template on Github, and are of unknown origin to me. Let’s try again, but with the initial parameters that I have identified.</p>
</section>
<section id="another-test-with-more-robut-parameters">
<h2>Another test - with more robut parameters<a class="headerlink" href="#another-test-with-more-robut-parameters" title="Link to this heading">#</a></h2>
<p>The parameters that we will use this time come from <a class="reference internal" href="3.Initial_Species_Parameters.html"><span class="std std-doc">Initial species parameters</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading parameters and launching a simple PnET sim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functionsForCalibration</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="c1"># Loading parameters from template</span>
<span class="n">PnETGitHub_OneCellSim</span> <span class="o">=</span> <span class="n">parse_All_LANDIS_PnET_Files</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;./SimulationFiles/PnETGitHub_OneCellSim_v8&quot;</span><span class="p">)</span>
<span class="c1"># Editing initial communities to only have single cohort of Abies Balsamea</span>
<span class="c1"># Updated for v8</span>
<span class="c1"># we clear all of the rows</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;initial-communities.csv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;initial-communities.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># We add a single new row for pinus banksiana with biomass 0 (there will be a spin up anyway)</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;initial-communities.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>	<span class="s2">&quot;abiebals&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]</span>

<span class="c1"># Editing cell length so that one cell = 1ha</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;scenario.txt&quot;</span><span class="p">][</span><span class="s2">&quot;CellLength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Putting duration to 120 years</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;scenario.txt&quot;</span><span class="p">][</span><span class="s2">&quot;Duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240</span>

<span class="c1"># We load the initial parameters (see 3.Initial_Species_Parameters.ipynb)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./SpeciesParametersSets/Initial/initialCoreSpeciesParameters.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">coreSpeciesParameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./SpeciesParametersSets/Initial/initialPnETSpeciesParameters.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">PnETSpeciesParametersFinal</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./SpeciesParametersSets/Initial/InitialGenericParameters.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">genericParameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

<span class="c1"># We replace the dictionnaries from the template with the ones with the initial parameters</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;species.txt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coreSpeciesParameters</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;SpeciesParameters.txt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PnETSpeciesParametersFinal</span>
<span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;PnETGenericParameters.txt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genericParameters</span>

<span class="c1"># Writing parameters in temporary folder</span>
<span class="n">testScenarioPath</span> <span class="o">=</span> <span class="s2">&quot;/tmp/TestScenarioPnET/&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">)</span>

<span class="n">write_all_LANDIS_files</span><span class="p">(</span><span class="n">testScenarioPath</span><span class="p">,</span>
                       <span class="n">PnETGitHub_OneCellSim</span><span class="p">,</span>
                       <span class="kc">True</span><span class="p">)</span>
<span class="c1"># Running LANDIS-II sim</span>
<span class="n">runLANDIS_Simulation</span><span class="p">(</span><span class="s2">&quot;/tmp/TestScenarioPnET/&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;scenario.txt&quot;</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="mi">5</span><span class="p">)</span>
<span class="c1"># Parsing outputs</span>
<span class="n">result_sitesCSV</span> <span class="o">=</span> <span class="n">parse_CSVFiles_PnET_SitesOutput</span><span class="p">(</span><span class="s2">&quot;/tmp/TestScenarioPnET/Output/Site1&quot;</span><span class="p">,</span>
                                                  <span class="nb">int</span><span class="p">(</span><span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;pnetsuccession.txt&quot;</span><span class="p">][</span><span class="s2">&quot;StartYear&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found : Additional file : !Run_scenario.bat
Found : PnET OutputBiomass parameter file : biomass.outputPnET.txt
Found : Climate file : climate.txt
Found : Disturbance Reduction File : disturbance_reductions.txt
Found : Additional file : ecoregion.img
Found : Main ecoregions file : ecoregion.txt
Found : PnET Ecoregion parameter file : EcoregionParameters.txt
Found : Initial Communities file : initial-communities.csv
Found : Additional file : initial-communities.img
Found : Additional file : Landis-log.txt
Found : PnET generic parameter file : PnETGenericParameters.txt
Found : PnET OutputSites parameter file : PnEToutputsites_onecell.txt
Found : Main PnET parameter file : pnetsuccession.txt
Found : Additional file : README.txt
Found : Main scenario file : scenario.txt
Found : Main species parameter file : species.txt
Found : PnET species parameters file : SpeciesParameters.txt
Found : Additional file : !Run_scenario.bat
Found : PnET OutputBiomass parameter file : biomass.outputPnET.txt
Found : Climate file : climate.txt
Found : Disturbance Reduction File : disturbance_reductions.txt
Found : Additional file : ecoregion.img
Found : Main ecoregions file : ecoregion.txt
Found : PnET Ecoregion parameter file : EcoregionParameters.txt
Found : dataframe : initial-communities.csv, exporting to .csv
Found : Additional file : initial-communities.img
Found : Additional file : Landis-log.txt
Found : PnET generic parameter file : PnETGenericParameters.txt
Found : PnET OutputSites parameter file : PnEToutputsites_onecell.txt
Found : Main PnET parameter file : pnetsuccession.txt
Found : Additional file : README.txt
Found : Main scenario file : scenario.txt
Found : Main species parameter file : species.txt
Found : PnET species parameters file : SpeciesParameters.txt
Launching LANDIS-II simulation with command : /bin/bash -c &quot;cd /tmp/TestScenarioPnET/ &amp;&amp; dotnet $LANDIS_CONSOLE scenario.txt&quot;
The LANDIS-II simulation has finished properly!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running FVS simulation with Abies balsamea</span>
<span class="n">balsamFir_HighSiteIndex</span> <span class="o">=</span> <span class="n">FVS_on_simulationOnSingleEmptyStand</span><span class="p">(</span><span class="n">Latitude</span> <span class="o">=</span> <span class="mf">42.73361</span><span class="p">,</span> <span class="c1"># Capital of michigan, to approximate where the parameters of this PnET sample scenario were made</span>
                                    <span class="n">Longitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">84.55556</span><span class="p">,</span> <span class="c1"># Capital of michigan, to approximate where the parameters of this PnET sample scenario were made</span>
                                    <span class="n">Slope</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no slope</span>
                                    <span class="n">Elevation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># We want ideal/neutral conditions, so no elevation </span>
                                    <span class="n">treeSpeciesCode</span> <span class="o">=</span> <span class="s2">&quot;BF&quot;</span><span class="p">,</span> <span class="c1"># Balsam fir, Abies balsamea. All codes are available at https://github.com/USDAForestService/ForestVegetationSimulator/blob/5c29887e4168fd8182c1b2bad762f900b7d7e90c/canada/on/grinit.f#L43</span>
                                    <span class="n">treesPerHectares</span> <span class="o">=</span> <span class="mi">2471</span><span class="p">,</span> <span class="c1"># To replicate stocking density from  https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085, supp. mat. A</span>
                                    <span class="n">siteIndex</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> <span class="c1"># High site index for the Balsam fir. See https://www.fs.usda.gov/nrs/pubs/gtr/gtr_nc128.pdf</span>
                                    <span class="n">variant</span> <span class="o">=</span> <span class="s2">&quot;FVSls&quot;</span><span class="p">,</span>
                                    <span class="n">Max_BA</span> <span class="o">=</span> <span class="mi">170</span><span class="p">,</span> <span class="c1"># Maximum basal area in stand. VERY IMPORTANT : https://cdnsciencepub.com/doi/10.1139/cjfr-2024-0085, supp. mat. A indicates that biomass groth is really overestimated in FVS unless this maximum is used (see BP 8). Can be found from empirical data (see documents sent by Brian Sturtevant).</span>
                                    <span class="n">timestep</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                    <span class="n">numberOfTimesteps</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
                                    <span class="n">folderForFiles</span> <span class="o">=</span> <span class="s2">&quot;/calibrationFolder/FVS_SingleEmptyStandRun&quot;</span><span class="p">,</span>
                                    <span class="n">clearFiles</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">balsamFir_HighSiteIndex</span><span class="p">)</span> <span class="c1"># WARNING : output is total aboveground live biomass in Metric Ton (Mg) per hectare.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been deleted.
The directory &#39;/calibrationFolder/FVS_SingleEmptyStandRun&#39; has been created.
Creating Database with stand and tree ini values
Creating Keyword file
Launching FVS sim
Detected unit in carbon outputs is US Tons/Acre. Will transform into Metric ton / hectare.
{2023: 0.8965080000000001, 2033: 48.411432000000005, 2043: 120.13207200000001, 2053: 133.57969200000002, 2063: 143.44128, 2073: 159.13017000000002, 2083: 176.16382199999998, 2093: 188.71493400000003, 2103: 197.68001400000003, 2113: 207.54160199999998, 2123: 213.81715800000003, 2133: 220.09271400000003, 2143: 225.02350800000002, 2153: 232.643826, 2163: 241.608906, 2173: 250.573986, 2183: 255.50478, 2193: 263.573352, 2203: 270.745416, 2213: 276.12446400000005}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ploting the outputs from PnET and FVS together</span>
<span class="c1"># We re-format the time entries of the FVS dictionnary so that years are expressed in absoluted (from 0 to 120)</span>
<span class="n">initialKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">balsamFir_HighSiteIndex</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># print(initialKeys)</span>
<span class="k">if</span> <span class="n">initialKeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">initialKeys</span><span class="p">:</span>
        <span class="n">balsamFir_HighSiteIndex</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">2023</span><span class="p">]</span> <span class="o">=</span> <span class="n">balsamFir_HighSiteIndex</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">balsamFir_HighSiteIndex</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<span class="n">plot_TimeSeries_CSV_PnETSitesOutputs</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">result_sitesCSV</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">referenceDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wood(gDW)&quot;</span><span class="p">:{</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">balsamFir_HighSiteIndex</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">balsamFir_HighSiteIndex</span><span class="o">.</span><span class="n">values</span><span class="p">())}},</span>
                                     <span class="n">columnToPlotSelector</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Wood(gDW)&quot;</span><span class="p">],</span>
                                     <span class="n">trueTime</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                     <span class="n">realBiomass</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">cellLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">PnETGitHub_OneCellSim</span><span class="p">[</span><span class="s2">&quot;scenario.txt&quot;</span><span class="p">][</span><span class="s2">&quot;CellLength&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>All plots have been generated and saved.
</pre></div>
</div>
<img alt="../_images/fbd4eca5dabcc1cf1febd93b6b77c28ace37a1ef33b35562bc7956040bcbb4cd.png" src="../_images/fbd4eca5dabcc1cf1febd93b6b77c28ace37a1ef33b35562bc7956040bcbb4cd.png" />
</div>
</div>
</section>
<section id="todo">
<h2>TODO<a class="headerlink" href="#todo" title="Link to this heading">#</a></h2>
<p>The problem : The curve of FVS is VERY influenced by the site index and by the maximum basal area. But it’s hard to get this data from empirical data !</p>
<p>But it’s not completly impossible either. In any case, we should not use the values used by Brian’s team, since these values represent the  maximum densities that the species were able to reach in their study region; and the site index also represent things possible in their study region.</p>
<p>While it is tempting to say that the parameters of Brian’s team can be used in other areas because the parameters of PnET should generate the right vegetation dynamics in another region as long as we change the parameters of the abiotic environment, I don’t think it’s true. It’s because what these parameters represent are not the physiology of a species throughout the world, but of the species in its local region. Species are an abstract notion, and nature is more complex; there can be a lot of intra-specific variation due to many factors. If we don’t calibrate on empirical data or empirical models from the study area, we will miss this intra-specific variation, and we might get the wrong results.</p>
<p>Possibilities :</p>
<ul class="simple">
<li><p>Switch to using pure empirical data to calibrate PnET : Sample plot data and local yield curve expressed in tons per hectare, or grams per m2 through time. Doable, but will require a lot of data cleaning and adaptation for different data sets throughout the different provinces.</p></li>
<li><p>Use FVS ontario, but derive site index and maximal basal area from empirical data as Brian’s team did. But we will get into more troubles as we move away from Ontario and Quebec (where FVS ontario has been calibrated and tested).</p>
<ul>
<li><p>We can also use the best we can for each region; i.e. use FVSon for Ontario and Quebec, and then see if the parameters we derive from there fits the growth curves in other provinces pretty well. FVSon still has the huge advantage of helping us to get an idea of what the dynamic in a monoculture looks like.</p></li>
<li><p>Ameray et al. said that they had mean site index data from the NFI. I can’t find them, but that would help tremendously.</p></li>
</ul>
</li>
</ul>
<p>Next :</p>
<ul class="simple">
<li><p>Ask Jesus if we can have box plots of Biomass (or merchentable volume) by year in our PSPs and TSPs that have a lot of the species of consideration (we can use the percentiles of the box plot to have a good idea of where to put the curve</p></li>
<li><p>Ask Jesus if he could help to find the Site Index for our sites, as well as the Maximum Basal Area based on Brian’s methodology</p></li>
<li><p>Ask Jesus what approach he would think is the best</p></li>
<li><p>Ask Ameray where he got their site index data</p></li>
<li><p>Consider the ground plots and the photo plots of the NFI (<a class="reference external" href="https://nfi.nfis.org/en/maps">https://nfi.nfis.org/en/maps</a>) : clicking on a ground plot on the map, we can see that we have data of the estimated leading species + the biomass + the age in the plot. Pretty perfect. Could have this throughout Canada. But the number of plots is much, much smaller than provincial plot data. Could at least be taken into account ?</p></li>
</ul>
<p>(Waiting for answers)</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./StartingCalibrationTest"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="4.Setting_up_calibration_Landscape.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Setting up the calibration landscape (ecoregions, initial communities, climate etc.)</p>
      </div>
    </a>
    <a class="right-next"
       href="6.Monoculture_ideal_conditions.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">1st calibration step : Monoculture in ideal condition</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-python-function-used-to-obtain-growth-data-from-fvs-for-a-monoculture">Custom python function used to obtain growth data from FVS for a monoculture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-comparing-fvs-outputs-to-pnet-outputs">Test : Comparing FVS outputs to PnET outputs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#another-test-with-more-robut-parameters">Another test - with more robut parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo">TODO</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Clément Hardy, PhD
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>